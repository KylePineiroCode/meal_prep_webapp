generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

enum DietType {
  OMNIVORE
  VEGETARIAN
  VEGAN
  PESCATARIAN
  KETO
  PALEO
  FLEXITARIAN
}

enum NutritionFocus {
  BALANCED
  HIGH_PROTEIN
  LOW_CARB
  LOW_FAT
  MUSCLE_GAIN
  FAT_LOSS
  ENDURANCE
}

enum Feeling {
  COMFORT
  ENERGIZED
  LIGHT
  ADVENTUROUS
  FOCUSED
}

enum MealType {
  BREAKFAST
  LUNCH
  DINNER
  SNACK
}

model User {
  id           String          @id @default(uuid())
  email        String          @unique
  name         String?
  createdAt    DateTime        @default(now())
  updatedAt    DateTime        @updatedAt
  preferences  UserPreference?
  mealPlans    MealPlan[]
  pantryItems  PantryItem[]
}

model UserPreference {
  id             String          @id @default(uuid())
  userId         String          @unique
  dietType       DietType        @default(OMNIVORE)
  nutritionFocus NutritionFocus?
  calorieTarget  Int?
  proteinTarget  Int?
  carbTarget     Int?
  fatTarget      Int?
  allergies      String[]        @default([])
  avoids         String[]        @default([])
  createdAt      DateTime        @default(now())
  updatedAt      DateTime        @updatedAt
  user           User            @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model PantryItem {
  id        String   @id @default(uuid())
  userId    String
  name      String
  quantity  Float?
  unit      String?
  expiresOn DateTime?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

model Recipe {
  id             String            @id @default(uuid())
  title          String
  description    String?
  mood           Feeling?
  nutritionFocus NutritionFocus?
  servings       Int               @default(1)
  prepTime       Int?
  cookTime       Int?
  calories       Int?
  protein        Float?
  carbs          Float?
  fat            Float?
  tags           String[]          @default([])
  sourceUrl      String?
  createdAt      DateTime          @default(now())
  updatedAt      DateTime          @updatedAt
  ingredients    RecipeIngredient[]
  steps          RecipeStep[]
  mealEntries    MealEntry[]

  @@index([nutritionFocus])
  @@index([mood])
}

model RecipeIngredient {
  id        String  @id @default(uuid())
  recipeId  String
  name      String
  quantity  Float?
  unit      String?
  notes     String?
  recipe    Recipe  @relation(fields: [recipeId], references: [id], onDelete: Cascade)

  @@index([recipeId])
}

model RecipeStep {
  id         String  @id @default(uuid())
  recipeId   String
  position   Int
  instruction String
  recipe     Recipe @relation(fields: [recipeId], references: [id], onDelete: Cascade)

  @@unique([recipeId, position])
}

model MealPlan {
  id             String           @id @default(uuid())
  userId         String
  title          String
  feeling        Feeling?
  focus          NutritionFocus?
  startDate      DateTime?
  endDate        DateTime?
  calorieTarget  Int?
  proteinTarget  Int?
  carbTarget     Int?
  fatTarget      Int?
  createdAt      DateTime         @default(now())
  updatedAt      DateTime         @updatedAt
  user           User             @relation(fields: [userId], references: [id], onDelete: Cascade)
  meals          MealEntry[]

  @@index([userId])
  @@index([focus])
}

model MealEntry {
  id         String   @id @default(uuid())
  mealPlanId String
  recipeId   String
  mealType   MealType
  dayOffset  Int      @default(0)
  notes      String?
  mealPlan   MealPlan @relation(fields: [mealPlanId], references: [id], onDelete: Cascade)
  recipe     Recipe   @relation(fields: [recipeId], references: [id], onDelete: Restrict)

  @@index([mealPlanId])
  @@index([recipeId])
  @@index([dayOffset])
}
